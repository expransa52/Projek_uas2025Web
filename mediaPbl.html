<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <title>Media Interaktif Sistem Pernapasan pada Manusia - Beranda</title>
    <link rel="icon" href="Logo.png">
    <link rel="stylesheet" href="mediaPbl.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body>
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header text-uppercase">menu</div>
        <a href="#" class="nav-link active" data-page="beranda"><i class="bi bi-house-door-fill"></i>Beranda</a>
        <a href="#" class="nav-link" data-page="materi"><i class="bi bi-journal-bookmark"></i>Materi</a>
        <a href="#" class="nav-link" data-page="kuis"><i class="bi bi-patch-question"></i>Kuis</a>
        <a href="#" class="nav-link" data-page="video"><i class="bi bi-play-circle"></i>Video </a>
        <a href="#" class="nav-link" data-page="tentang"><i class="bi bi-info-circle"></i>Tentang</a>
        <button class="logout-link" onclick="logout()"><i class="bi bi-box-arrow-right"></i>KELUAR</button>
    </div>

    <div id="main-content">
        <div class="topbar">
            <button class="sidebar-toggle" id="sidebarToggle"><i class="bi bi-list"></i></button>
            <marquee direction="left" class="pixel-marquee text-capitalize">
                apakah kamu siap belajar hari ini!
            </marquee>
        </div>

        <div id="beranda-page" class="beranda-bg page-section">
            <div class="pixel-bg-clouds">
                <svg width="100%" height="100%">
                    <rect x="30" y="30" width="80" height="20" fill="#fff" />
                    <rect x="200" y="50" width="100" height="25" fill="#fff" />
                    <rect x="450" y="20" width="90" height="18" fill="#fff" />
                    <rect x="700" y="60" width="70" height="15" fill="#fff" />
                </svg>
            </div>
            <div class="pixel-title">ARE YOU READY?<br>MEDIA INTERAKTIF SISTEM PERNAPASAN</div>
            <div class="pixel-subtitle">Belajar Sistem Pernapasan dengan Cara Menyenangkan!</div>
            <div class="pixel-character">
                <img src="https://img.icons8.com/external-flatart-icons-outline-flatarticons/96/000000/external-lung-anatomy-flatart-icons-outline-flatarticons.png"
                    alt="Paru-paru Lucu" />
            </div>
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-12 pixel-menu-row">
                        <button class="pixel-btn" onclick="showPage('materi')"><i
                                class="bi bi-journal-bookmark"></i>MATERI</button>
                        <button class="pixel-btn" onclick="showPage('kuis')"><i
                                class="bi bi-patch-question"></i>QUIZ</button>
                    </div>
                    <div class="col-12 pixel-menu-row">
                        <button class="pixel-btn" onclick="showPage('video')"><i
                                class="bi bi-play-circle"></i>VIDEO</button>
                        <button class="pixel-btn" onclick="showPage('tentang')"><i
                                class="bi bi-info-circle"></i>TENTANG</button>
                        <button class="pixel-btn" onclick="logout()"><i
                                class="bi bi-box-arrow-right"></i>KELUAR</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="beranda-page" class="beranda-bg page-section" style="position:relative;">

            <div class="music-controls" style="position: absolute; top: 20px; right: 30px; z-index: 10;">
                <audio id="audioPlayer">
                    <source src="Musik untuk projek akhir.mp3" type="audio/mpeg">
                    Browser tidak mendukung audio.
                </audio>
                <button class="btn-circle" id="volumeBtn" title="Mute/Unmute">
                    <i id="volume-icon" class="fas fa-volume-up"></i>
                </button>
                <button class="btn-circle" id="musicBtn" title="Play/Pause">
                    <i id="music-icon" class="fas fa-music"></i>
                </button>
            </div>

        </div>


        <div id="materi-page" class="fitur-page page-section d-none">
            <div class="fitur-title">Materi Sistem Pernapasan</div>
            <div class="fitur-content" id="materi-content-from-firebase">
                <p>Memuat materi...</p>
            </div>
        </div>

        <div id="kuis-page" class="fitur-page page-section d-none">
            <div class="fitur-title">Kuis</div>
            <div class="fitur-content">
                <p>Konten Kuis akan ada di sini atau dimuat dari Kuis.html.</p>
            </div>
        </div>

        <div id="video-page" class="fitur-page page-section d-none">
            <div class="fitur-title">Video Pembelajaran</div>
            <div class="fitur-content video-grid-container">
                <h4 class="video-section-heading text-capitalize">ada berbagai video pembelajaran untuk di tonton:</h4>

                <iframe width="560" height="315" src="https://www.youtube.com/embed/AKW3Zen8DD4?si=LwwDSztZlHughRO9"
                    title="Sistem Pernapasan Manusia" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>


                <iframe width="560" height="315" src="https://www.youtube.com/embed/BN_kF5BYrT4?si=pGTywFVR-sOUzu7p"
                    title="Sistem Pernapasan pada Manusia" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

                <iframe width="560" height="315" src="https://www.youtube.com/embed/s48V8Edn328?si=GXzGGUxQ14Gdz7CQ"
                    title="Video Materi Pernapasan Manusia" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

                <iframe width="560" height="315" src="https://www.youtube.com/embed/oQPfpHYmkew?si=LPl3VhdaapK3hphC"
                    title="Organ Pernapasan Manusia" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

                <iframe width="560" height="315" src="https://www.youtube.com/embed/U31-lddMz9M?si=yDG2wCQDY8yEgU3f"
                    title="Proses Pernapasan Manusia" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

                <iframe width="560" height="315" src="https://www.youtube.com/embed/Y3DuNMBZTAA?si=Snnqos9JmrXrX038"
                    title="Gangguan Sistem Pernapasan" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

            </div>
        </div>
    </div>

    <div id="tentang-page" class="fitur-page page-section d-none">
        <div class="fitur-title">Tentang</div>
        <div class="fitur-content" id="tentang-content-from-firebase">
            <p>Memuat konten...</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="mediaPbl.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

        // Firebase Pertama
        const firebaseConfigMateri = {
            apiKey: "AIzaSyDWS-yRGyvLClGWiBeq_Z_BcZ-kBgHll8M",
            authDomain: "materiprojek-70911.firebaseapp.com",
            databaseURL: "https://materiprojek-70911-default-rtdb.firebaseio.com",
            projectId: "materiprojek-70911",
            storageBucket: "materiprojek-70911.firebasestorage.app",
            messagingSenderId: "755242949891",
            appId: "1:755242949891:web:2bbde5a922b54cfa0f9d36",
            measurementId: "G-137P86T9LE"
        };

        // Firebase Kedua
        const firebaseConfigTentang = {
            apiKey: "AIzaSyAVDh4dG81_JlmkMmIztd4m9gRaO-msMYc",
            authDomain: "tentang-web.firebaseapp.com",
            databaseURL: "https://tentang-web-default-rtdb.firebaseio.com",
            projectId: "tentang-web",
            storageBucket: "tentang-web.firebasestorage.app",
            messagingSenderId: "262389729779",
            appId: "1:262389729779:web:3e1ea6a3d725d764ea6a86"
        };

        // Materi
        const appMateri = initializeApp(firebaseConfigMateri, "materiApp");
        const analytics = getAnalytics(appMateri);
        const databaseMateri = getDatabase(appMateri);

        // Tentang
        const appTentang = initializeApp(firebaseConfigTentang, "tentangApp");
        const databaseTentang = getDatabase(appTentang);

        const materiRef = ref(databaseMateri, 'materi_sistem_pernapasan');
        const materiContentDiv = document.getElementById('materi-content-from-firebase');
        
        let materiDetailDiv = document.getElementById('materi-detail-page');
        if (!materiDetailDiv) {
            materiDetailDiv = document.createElement('div');
            materiDetailDiv.id = 'materi-detail-page';
            materiDetailDiv.className = 'materi-detail-page d-none';
            materiContentDiv.parentNode.appendChild(materiDetailDiv);
        }

        onValue(materiRef, (snapshot) => {
            const materiData = snapshot.val();

            if (materiData && materiData.subbab && Array.isArray(materiData.subbab)) {
                let materiHtml = '';
                if (materiData.judul) {
                    materiHtml += `<h2 class="materi-main-title text-center mb-4">${materiData.judul}</h2>`;
                }
                materiHtml += `<div class="materi-cards-container">`;

                const gambarStatis = [
                    "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSvinPgqTOOR4Y2UXvL6YUEwk4YbMGPjG6G-w&s",
                    "https://i.pinimg.com/736x/1e/b1/71/1eb171ef981db3f799b2839ea2a862c4.jpg",
                    "https://png.pngtree.com/png-clipart/20190613/original/pngtree-number-3-logo-icon-template-png-image_3565204.jpg"
                ];

                materiData.subbab.forEach((subbab, idx) => {
                    let preview = "";
                    if (subbab.isi && Array.isArray(subbab.isi) && subbab.isi[0]) {
                        preview = subbab.isi[0].isi_sub ? subbab.isi[0].isi_sub.slice(0, 90) + "..." : "";
                    }

                    let gambar = gambarStatis[idx] || "https://via.placeholder.com/150";

                    materiHtml += `
                    <div class="materi-wrapper">
                        <div class="materi-image">
                            <img src="${gambar}" alt="Gambar ${subbab.judul}">
                        </div>
                        <div class="materi-content">
                            <h3 class="materi-title">${subbab.judul}</h3>
                            <button class="btn-detail" data-idx="${idx}">Lihat Detail</button>
                        </div>
                    </div>
                `;
                });

                materiHtml += `</div>`;
                materiContentDiv.innerHTML = materiHtml;
                materiContentDiv.classList.remove('d-none');
                materiDetailDiv.classList.add('d-none');

                // Tombol Lihat Detail
                document.querySelectorAll('.btn-detail').forEach(btn => {
                    btn.onclick = () => {
                        const idx = btn.getAttribute('data-idx');
                        showMateriDetail(idx, materiData);
                    };
                });

                // Menampilkan detail materi
                function showMateriDetail(idx, materiData) {
                    const subbab = materiData.subbab[idx];
                    let detailHtml = `<button class="btn-back-materi">&larr; Kembali ke Daftar Materi</button>`;
                    detailHtml += `<h2>${subbab.judul}</h2>`;
                    if (subbab.isi && Array.isArray(subbab.isi)) {
                        subbab.isi.forEach(item => {
                            if (item.judul_sub) detailHtml += `<h4>${item.judul_sub}</h4>`;
                            if (item.isi_sub) detailHtml += `<p>${item.isi_sub}</p>`;
                        });
                    }
                    materiDetailDiv.innerHTML = detailHtml;
                    materiContentDiv.classList.add('d-none');
                    materiDetailDiv.classList.remove('d-none');

                    // Tombol kembali ke daftar
                    materiDetailDiv.querySelector('.btn-back-materi').onclick = () => {
                        materiDetailDiv.classList.add('d-none');
                        materiContentDiv.classList.remove('d-none');
                        window.scrollTo({ top: materiContentDiv.offsetTop - 30, behavior: 'smooth' });
                    };
                }

            } else {
                materiContentDiv.innerHTML = "<p>Konten materi tidak ditemukan di database atau kosong.</p>";
            }
        }, (error) => {
            console.error("Error membaca data 'materi':", error);
            materiContentDiv.innerHTML = "<p>Terjadi kesalahan saat memuat materi. Periksa konsol browser untuk detail.</p>";
        });

        const tentangRef = ref(databaseTentang, 'tentang');
        const tentangContentDiv = document.getElementById('tentang-content-from-firebase');

        onValue(tentangRef, (snapshot) => {
            const tentangText = snapshot.val();
            if (tentangText) {
                tentangContentDiv.innerHTML = tentangText;
            } else {
                tentangContentDiv.innerHTML = "<p>Konten 'Tentang' tidak ditemukan di database atau kosong.</p>";
            }
        }, (error) => {
            console.error("Error membaca data 'tentang':", error);
            tentangContentDiv.innerHTML = "<p>Terjadi kesalahan saat memuat konten.</p>";
        });
    </script>
</body>
</html>
